define("wizard",["i18n","SensorWidget","SOS","jquery","moment","daterangepicker","jquery-ui","bootstrap","highlight"],function(e,t,a,n,r){"use strict";function i(){var e=["compass","gauge","jqgrid","map","panel","progressbar","status","table","thermometer","timechart","windrose"],t=["default","primary","success","info","warning","danger"],a="";for(var r in e){var i=e[r],o=t[r%t.length];a+='<a role="button" class="menu-btn btn btn-'+o+' btn-lg" id="'+i+'"><div class="flaticon-'+i+'"></div>'+v(i)+"&nbsp;&nbsp;»</a>"}document.getElementById("main-menu").innerHTML=a,n(".menu-btn").click(function(){s(this.id)})}function o(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function s(a){n("#widget-form-title").html(e.t("{name} Widget Configuration",{name:v(a)})),new t(a).inspect(function(t,r,i){var o,s,f,b,h="<fieldset><legend>"+e.t("Mandatory inputs")+"</legend>";for(var y in t){switch(o=t[y],s="",f=v(o),b="",o){case"service":case"offering":case"feature":case"property":s='<select class="form-control" id="'+o+'"></select>';break;case"features":case"properties":s='<select class="form-control" multiple id="'+o+'"></select>',f+=" "+e.t("(multiselect)");break;case"refresh_interval":var w=[5,10,30,60,120];for(var k in w){var z=w[k];b+='<option id="'+z+'">'+z+"</option>"}s='<select class="form-control" id="'+o+'">'+b+"</select>";break;case"time_start":n.inArray("time_end",t)&&(f=e.t("Time Range")+" (UTC)",s='<input class="form-control" type="text" id="time_range" disabled />');break;case"time_end":break;default:s='<input class="form-control" type="text" value="" id="'+o+'"/>'}s&&(h+='<div class="form-group"><label class="col-lg-4 control-label" for="'+o+'">'+f+'</label><div class="col-lg-8">'+s+"</div></div>")}h+="</fieldset>",h+="<fieldset><legend>"+e.t("Optional inputs")+"</legend>";for(y in r){switch(o=r[y],s="",f=v(o),b="",o){default:s='<textarea class="form-control" value="" id="'+o+'"></textarea>'}h+='<div class="form-group"><label class="col-lg-4 control-label" for="'+o+'">'+f+'</label><div class="col-lg-8">'+s+"</div></div>"}h+="</fieldset>",h+="<fieldset><legend>"+e.t("Widget dimensions")+"</legend>",o="sizes",f=e.t("Initial Size");for(y in i){var L=i[y];b+='<option id="size" value="'+y+'">'+L.w+" x "+L.h+" px</option>"}var T='<select class="form-control" id="sizes">'+b+"</select>";h+='<div class="form-group"><label class="col-lg-4 control-label" for="'+o+'">'+f+'</label><div class="col-lg-8">'+T+"</div></div>",h+="</fieldset>",h+='<input type="button" name="build" class="btn btn-primary pull-right" value="'+e.t("Create Widget")+'&nbsp;&nbsp;»"/>',n("#widget-form").html(h),n('[name="build"]').data({name:a,inputs:t,optionalInputs:r,preferredSizes:i}).click(g),l(["http://demo.geomati.co/sos/json","http://sensors.portdebarcelona.cat/sos/json","/52n-sos/sos/json"]),n("#service").change(function(){m();var e=n("#service").find("option:selected").attr("id");d(e)}),n("#offering").change(function(){var e=n("#offering").find("option:selected").data("procedure");p(e),c(e)}),n("#feature").change(function(){u()}),n("#features").change(function(){u()}),n("#property").change(function(){u()}),n("#properties").change(function(){u()})})}function l(t){var a=n("#service");if(t&&a){a.append(n("<option>").append(e.t("Select a Service...")));for(var r in t){var i=t[r];a.append(n("<option>").attr("id",i).append(i))}}}function d(t){f("#offering","#property","#properties","#feature","#features"),t&&(n("#offering").append(n("<option>").append(e.t("Select an Offering..."))),a.setUrl(t),a.getCapabilities(function(e){for(var t in e){var a=e[t];n("#offering").append(n("<option>").attr("id",a.identifier).data("procedure",a.procedure[0]).append(a.name))}},m))}function c(e){f("#property","#properties"),e&&a.describeSensor(e,function(e){var t=e.hasOwnProperty("ProcessModel")?e.ProcessModel.outputs.OutputList.output:e.System.outputs.OutputList.output;t=t instanceof Array?t:[t];for(var a in t){var r=t[a],i=["Quantity","Count","Boolean","Category","Text","ObservableProperty"];for(var o in i){var s=i[o];r.hasOwnProperty(s)&&(r.type=s,r.id=r[s].definition,r.description=r.name+" ("+s,"Quantity"==s&&r[s].hasOwnProperty("uom")&&(r.description+=" ["+r[s].uom.code+"]"),r.description+=")")}n("#property, #properties").append(n("<option>").attr("id",r.id).append(r.description))}},m)}function p(e){f("#feature","#features"),e&&a.getFeatureOfInterest(e,function(e){for(var t in e){var a=e[t],r=a.identifier.value,i=a.name.value;n("#feature, #features").append(n("<option>").attr("id",r).append(i))}},m)}function u(){var t=n("#time_range");if(t.length){var i=n("#offering").find("option:selected").data("procedure"),o=n("#feature").find("option:selected").attr("id"),s=n("#property").find("option:selected").attr("id"),l=o?o:n("#features").find("option:selected").map(function(){return this.id}).get(),d=s?s:n("#properties").find("option:selected").map(function(){return this.id}).get();a.getDataAvailability(i,l,d,function(a){for(var n,i,o=a[0].phenomenonTime[0],s=a[0].phenomenonTime[1],l=1;l<a.length;l++)n=a[l].phenomenonTime[0],i=a[l].phenomenonTime[1],o>n&&(o=n),i>s&&(s=i);r.locale(e.getLang());var d=[];d[e.t("Today")]=[r().startOf("day"),r()],d[e.t("Last hour")]=[r().subtract(1,"hour"),r()];for(var c in[3,6,12,24])d[e.t("Last {n} hours",{n:c})]=[r().subtract(c,"hours"),r()];var p,u={timePicker:!0,format:e.t("MMM D, YYYY H:mm"),timePickerIncrement:5,timePicker12Hour:!1,timePickerSeconds:!1,timeZone:"+00:00",minDate:r.utc(o),maxDate:r.utc(s),dateLimit:{days:7},ranges:d,locale:{applyLabel:e.t("Apply"),cancelLabel:e.t("Cancel"),fromLabel:e.t("From"),toLabel:e.t("To"),weekLabel:e.t("W"),customRangeLabel:e.t("Custom Range")}};if(t.prop("disabled"))t.daterangepicker(u),p=t.data("daterangepicker"),t.prop("disabled",!1),p.setStartDate(r.max(r.utc(o),r.utc(s).subtract(1,"day"))),p.setEndDate(r.utc(s));else{p=t.data("daterangepicker"),p.setOptions(u);var f=(new Date).getTimezoneOffset();n=p.startDate.subtract(f,"minutes"),i=p.endDate.subtract(f,"minutes"),p.setStartDate(r.max(r.utc(o),n)),p.setEndDate(r.min(r.utc(s),i))}},m)}}function f(){for(var e=0;e<arguments.length;e++)n(arguments[e])&&n(arguments[e]).find("option").remove();n("#time_start").val(""),n("#time_end").val("")}function g(){var e,a,r,i=n('[name="build"]').data(),s={},l=function(){return this.id};for(var d in i.inputs){switch(e=i.inputs[d],a=n("#"+e),e){case"service":case"offering":case"feature":case"property":r=a.find("option:selected").attr("id");break;case"features":case"properties":r=a.find("option:selected").map(l).get();break;case"time_start":r=n("#time_range").data("daterangepicker").startDate.utc().format("YYYY-MM-DD[T]HH:mm:ss[Z]");break;case"time_end":r=n("#time_range").data("daterangepicker").endDate.utc().format("YYYY-MM-DD[T]HH:mm:ss[Z]");break;default:r=a.val()}r&&(s[e]=r)}for(d in i.optionalInputs)e=i.optionalInputs[d],a=n("#"+e),r=a.val(),r&&(s[e]=r);var c=i.preferredSizes[n("#sizes").val()],p=n("#widget-container");p.draggable(),p.resizable("destroy"),n("#widget-container").width(c.w).height(c.h+39);var u=new t(i.name,s,w);p.resizable({helper:"ui-resizable-helper",resize:function(e,t){document.getElementById("embed").innerHTML=o(u.iframe(t.size.width,t.size.height-39))}}),document.getElementById("code").innerHTML=u.javascript(),hljs.highlightBlock(document.getElementById("code")),document.getElementById("embed").innerHTML=o(u.iframe(c.w,c.h)),hljs.highlightBlock(document.getElementById("embed")),document.getElementById("link").innerHTML='<a href="'+u.url()+'" target="_blank">'+u.url()+"</a>"}function m(e,t,a){var n="";t&&(n="["+t+"] "),a&&a.request&&(n+=a.request+": "),e&&(n+=e),w.innerHTML='<div class="text-danger">'+n+"</div>"}function v(t){return e.t(t.toLowerCase().replace(/_/g," ").replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()}))}var b={"Sensor Widget Wizard":{es:"Wizard Sensor Widgets",ca:"Wizard Sensor Widgets"},"Widget Configuration Form":{es:"Formulario de configuración",ca:"Formulari de configuració"},"Widget View":{es:"Vista del Widget",ca:"Vista del Widget"},"Take Away":{es:"Para llevar",ca:"Emporteu-vos-el"}};e.addTranslations(b),e.translateDocTree();var h='<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">'+e.langs()[e.getLang()]+' <span class="caret"></span></a>';h+='<ul class="dropdown-menu">';for(var y in e.langs())y!=e.getLang()&&(h+='<li><a href="?lang='+y+'">'+e.langs()[y]+"</a></li>");h+="</ul>",document.getElementById("lang-selector").innerHTML=h,i(),n(".panel").draggable({handle:".panel-heading"}),n(".width-resizable-panel").resizable({handles:"e, w"}),n("#widget-container").resizable();var w=document.getElementById("widget-view")}),require(["wizard"]);