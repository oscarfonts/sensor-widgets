{"version":3,"sources":["webpack:///./src/js/jQuery-globals.js","webpack:///./src/js/sos-data-access.js","webpack:///./node_modules/flot/source sync flot.*\\.js$","webpack:///./src/js/widget/timechart.js"],"names":["window","$","jQuery","propertyNames","waitingDescribeResponse","propertyCallbackQueue","parse","observations","length","redraw","data","addObservation","property","observation","foi","featureOfInterest","push","time","Date","resultTime","value","Object","prototype","hasOwnProperty","call","result","feature","name","identifier","uom","values","forEach","procedure","id","callback","context","observableProperty","describeSensor","description","properties","ProcessModel","outputs","OutputList","output","System","Array","types","names","type","definition","elem","shift","undefined","errorHandler","setUrl","config","service","read","offering","features","time_start","time_end","getFeatures","JSON","getProperties","getObservation","map","webpackContext","req","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","resolve","module","exports","flotReq","template","join","timechart","inputs","concat","optional_inputs","preferredSizes","w","h","el","innerHTML","querySelector","title","graph","init","series","i","measure","label","getTime","arr","k","sort","a","b","options","xaxis","mode","timezone","utc","yaxis","zoomRange","panRange","grid","hoverable","legend","container","lines","show","points","tooltip","tooltipOpts","content","zoom","interactive","pan","colors","plot"],"mappings":"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","file":"widget-timechart-js.chunk.js","sourcesContent":["import $ from 'jquery';\n\nwindow.$ = $;\nwindow.jQuery = $;\nexport default $;\n","/* eslint-disable no-nested-ternary, camelcase */\nimport SOS, { isArray } from './SOS';\n\nconst propertyNames = {};\nconst waitingDescribeResponse = {};\nconst propertyCallbackQueue = {};\n\nexport default (config, redraw, errorHandler) => {\n  SOS.setUrl(config.service);\n\n  function getPropertyName(procedure, id, callback, context) {\n    if (!propertyNames[procedure]) {\n      // Queue callback call\n      if (!propertyCallbackQueue[procedure]) {\n        propertyCallbackQueue[procedure] = [];\n      }\n\n      propertyCallbackQueue[procedure].push({\n        callback,\n        id,\n        context,\n      });\n\n      if (!waitingDescribeResponse[procedure]) {\n        waitingDescribeResponse[procedure] = true;\n        // Trigger a DescribeSensor, cache all property names for this procedure\n        SOS.describeSensor(procedure, (description) => {\n          let properties = Object.prototype.hasOwnProperty.call(description, 'ProcessModel')\n            ? description.ProcessModel.outputs.OutputList.output\n            : description.System.outputs.OutputList.output;\n          properties = properties instanceof Array ? properties : [properties];\n          const types = ['Quantity', 'Count', 'Boolean', 'Category', 'Text', 'ObservableProperty'];\n\n          const names = [];\n          Object.values(properties).forEach((property) => {\n            Object.values(types).forEach((type) => {\n              if (Object.prototype.hasOwnProperty.call(property, type)) {\n                // eslint-disable-next-line no-param-reassign\n                property.id = property[type].definition;\n              }\n            });\n            names[property.id] = property.name;\n          });\n          propertyNames[procedure] = names;\n\n          // Clear propertyCallbackQueue\n          while (propertyCallbackQueue[procedure].length) {\n            const elem = propertyCallbackQueue[procedure].shift();\n            elem.callback.call(undefined, propertyNames[procedure][elem.id], elem.context);\n          }\n        }, errorHandler);\n      }\n    } else {\n      callback(propertyNames[procedure][id], context);\n    }\n  }\n\n  function parse(observations) {\n    if (!observations.length) {\n      redraw([]);\n    }\n\n    // Get tabular data from observations\n    const data = [];\n\n    function addObservation(property, observation) {\n      const foi = observation.featureOfInterest;\n      data.push({\n        time: new Date(observation.resultTime),\n        value: Object.prototype.hasOwnProperty.call(observation.result, 'value') ? observation.result.value : observation.result,\n        feature: foi.name ? foi.name.value : (foi.identifier ? foi.identifier.value : foi),\n        property,\n        uom: Object.prototype.hasOwnProperty.call(observation.result, 'uom') ? observation.result.uom : '(N/A)',\n      });\n      if (data.length === observations.length) {\n        redraw(data);\n      }\n    }\n    Object.values(observations).forEach((observation) => {\n      getPropertyName(observation.procedure, observation.observableProperty,\n        addObservation, observation);\n    });\n  }\n\n  function read() {\n    const {\n      offering, feature, property, features, properties, time_start, time_end,\n    } = config;\n    const getFeatures = feature\n      ? [feature]\n      : isArray(features)\n        ? features\n        : features\n          ? JSON.parse(features)\n          : undefined;\n    const getProperties = property\n      ? [property]\n      : isArray(properties)\n        ? properties\n        : properties\n          ? JSON.parse(properties)\n          : undefined;\n    const time = (time_start && time_end) ? [time_start, time_end] : 'latest';\n    SOS.getObservation(offering, getFeatures, getProperties, time, parse, errorHandler);\n  }\n\n  return {\n    read,\n  };\n};\n","var map = {\n\t\"./jquery.flot.axislabels.js\": 237,\n\t\"./jquery.flot.browser.js\": 238,\n\t\"./jquery.flot.categories.js\": 239,\n\t\"./jquery.flot.composeImages.js\": 240,\n\t\"./jquery.flot.crosshair.js\": 241,\n\t\"./jquery.flot.drawSeries.js\": 242,\n\t\"./jquery.flot.errorbars.js\": 243,\n\t\"./jquery.flot.fillbetween.js\": 244,\n\t\"./jquery.flot.flatdata.js\": 245,\n\t\"./jquery.flot.hover.js\": 246,\n\t\"./jquery.flot.image.js\": 247,\n\t\"./jquery.flot.js\": 214,\n\t\"./jquery.flot.legend.js\": 248,\n\t\"./jquery.flot.logaxis.js\": 249,\n\t\"./jquery.flot.navigate.js\": 250,\n\t\"./jquery.flot.pie.js\": 251,\n\t\"./jquery.flot.resize.js\": 252,\n\t\"./jquery.flot.saturated.js\": 253,\n\t\"./jquery.flot.selection.js\": 254,\n\t\"./jquery.flot.stack.js\": 255,\n\t\"./jquery.flot.symbol.js\": 256,\n\t\"./jquery.flot.threshold.js\": 257,\n\t\"./jquery.flot.time.js\": 258,\n\t\"./jquery.flot.touch.js\": 259,\n\t\"./jquery.flot.touchNavigate.js\": 260,\n\t\"./jquery.flot.uiConstants.js\": 215\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 236;","/* eslint-disable no-param-reassign */\nimport dataAccess from '../sos-data-access';\nimport ld from '../locale-date';\nimport common from '../widget-common';\n\nimport $ from '../jQuery-globals';\n\nimport 'flot/lib/jquery.mousewheel';\nimport 'flot/source/jquery.canvaswrapper';\nimport 'flot/source/jquery.colorhelpers';\nimport 'flot/source/jquery.flot';\nimport 'flot/source/jquery.flot.uiConstants';\n\nimport 'flot-plugins/dist/source/misc/jquery.flot.tooltip';\n\nconst flotReq = require.context('../../../node_modules/flot/source/', true, /flot.*\\.js$/);\nflotReq.keys().forEach(flotReq);\n\n// TODO readd legend\n// TODO readd pan and zoom\n\nconst template = [\n  '<div class=\"timechart widget\">',\n  '<h3 style=\"width:100%\"></h3>',\n  '<div class=\"graph\" style=\"height:75%; width: 100%; max-height: 380px;\"></div>',\n  '<div class=\"legend\" style=\"display: inline-block; float: right; margin-right: 15px; margin-left: 50px; margin-top: 10px\"></div>',\n  '<div><span class=\"footnote\"></span></div>',\n  '</div>',\n].join('');\n\nconst timechart = {\n  inputs: common.inputs.concat(['features', 'properties', 'time_start', 'time_end', 'title']),\n  optional_inputs: common.optional_inputs,\n  preferredSizes: [{ w: 650, h: 530 }],\n\n  init(config, el, errorHandler) {\n    // Render template\n    el.innerHTML = template;\n    el.querySelector('h3').innerHTML = config.title;\n    const graph = el.querySelector('.graph');\n\n    // load widget common features\n    common.init(config, el);\n\n    function redraw(data) {\n      const series = {};\n      Object.keys(data).forEach((i) => {\n        const measure = data[i];\n        const label = `${measure.property} (${measure.feature})`;\n        if (!series[label]) {\n          series[label] = {\n            data: [],\n            label,\n          };\n        }\n        series[label].data.push([measure.time.getTime() / 1000, measure.value]);\n      });\n\n      // Sort data by time, convert to array\n      const arr = [];\n      Object.keys(series).forEach((k) => {\n        series[k].data.sort((a, b) => b[0] - a[0]);\n        arr.push(series[k]);\n      });\n\n      const options = {\n        xaxis: {\n          mode: 'time',\n          timezone: ld.utc() ? 'UTC' : 'browser',\n        },\n        yaxis: {\n          zoomRange: false,\n          panRange: false,\n        },\n        grid: {\n          hoverable: true,\n        },\n        legend: {\n          container: el.querySelector('.legend'),\n        },\n        series: {\n          lines: {\n            show: true,\n          },\n          points: {\n            show: true,\n          },\n        },\n        tooltip: true,\n        tooltipOpts: {\n          content: data.length ? `[%x] %s: %y.2 ${data[0].uom}` : '',\n        },\n        zoom: {\n          interactive: true,\n        },\n        pan: {\n          interactive: true,\n        },\n      };\n\n      if (config.colors) {\n        options.colors = config.colors;\n      }\n\n      const plot = $.plot(graph, arr, options);\n\n      if (config.callback) {\n        config.callback(plot, graph);\n      }\n    }\n\n    // Setup SOS data access\n    const data = dataAccess(config, redraw, errorHandler);\n    data.read();\n  },\n};\n\nexport default timechart;\n"],"sourceRoot":""}